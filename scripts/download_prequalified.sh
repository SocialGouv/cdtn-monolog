#!/bin/bash
curl --request POST \
  --url https://preprod-cdtn-admin.dev2.fabrique.social.gouv.fr/api/graphql \
  --header 'Content-Type: application/json' \
  --header 'authorization:  Bearer '$ADMIN_JWT'' \
  --data '{"query":"query documents($source: String, $search: String!, $published: [Boolean!]!, $offset: Int = 0, $limit: Int = 50) {\n  documents(\n    where: {_not: {document: {_has_key: \"split\"}}, _and: {source: {_eq: $source, _neq: \"code_du_travail\"}, title: {_ilike: $search}, is_published: {_in: $published}}}\n    offset: $offset\n    limit: $limit\n    order_by: [{source: asc}, {slug: asc}]\n  ) {\n    id: initial_id\n    cdtnId: cdtn_id\n   document\n   contentRelations: relation_a(where: {type: {_eq: \"document-content\"}}) {\n      position: data(path: \"position\")\n      content: b {\n        cdtnId: cdtn_id\n        slug\n        source\n        title\n          }\n    } \n   title\n    source\n    isPublished: is_published\n    __typename\n  }\n  documents_aggregate(\n    where: {_not: {document: {_has_key: \"split\"}}, _and: {source: {_eq: $source, _neq: \"code_du_travail\"}, title: {_ilike: $search}, is_published: {_in: $published}}}\n  ) {\n    aggregate {\n      count\n      __typename\n    }\n    __typename\n  }\n}\n","operationName":"documents","variables":{"limit":10000,"offset":0,"published":[true,false],"search":"%%","source":"prequalified"}}'
